# Income Flow REST Testing

## О проекте
Автоматизированные тесты для REST API сервиса управления товарами. Написаны на Python с использованием Pytest и Requests для проверки всех CRUD операций. Тесты обеспечивают полное покрытие функциональности API и проверку обработки ошибок.

## Технологии
- **Python** - основной язык тестирования
- **Pytest** - фреймворк тестирования
- **Requests** - HTTP клиент для API запросов

## Структура проекта
- `income_testing_api.py` - полный набор тестов для всех API endpoints
- `readme.md` - подробная документация

## Подробное описание тестов

### 1. test_get_all_goods()
**Назначение**: Проверка получения всех товаров
**Endpoint**: `POST /good/get_all`
**Проверки**:
- Статус ответа 200
- Ответ является списком
- Список содержит минимум 1 товар

### 2. test_get_one_good()
**Назначение**: Проверка получения одного товара по ID
**Endpoint**: `POST /good/get`
**Логика**:
- Сначала получает все товары
- Берет ID первого товара из списка
- Запрашивает товар по этому ID
**Проверки**:
- Статус ответа 200
- ID полученного товара совпадает с запрошенным

### 3. test_create_good(sample_good)
**Назначение**: Проверка создания нового товара
**Endpoint**: `POST /good/create`
**Тестовые данные**: Товар с ID=12, названием "Test Product"
**Проверки**:
- Статус ответа 200
- Созданный товар имеет правильное название и ID
- Товар появляется в общем списке
- Автоматическая очистка: удаление созданного товара

### 4. test_update_good(sample_good)
**Назначение**: Проверка обновления существующего товара
**Endpoint**: `POST /good/update`
**Логика**:
- Создает тестовый товар
- Обновляет его данные (название, описание, количество, вес)
- Проверяет изменения
**Проверки**:
- Статус ответа 200
- Название изменено на "Updated Name"
- Количество изменено на 99
- Вес изменен на 9.9
- Автоматическая очистка: удаление тестового товара

### 5. test_delete_good(sample_good)
**Назначение**: Проверка удаления товара
**Endpoint**: `POST /good/delete`
**Логика**:
- Создает тестовый товар
- Удаляет его
- Проверяет, что товар действительно удален
**Проверки**:
- Статус ответа 200 при удалении
- Статус ответа 404 при попытке получить удаленный товар

### 6. test_get_nonexistent_good()
**Назначение**: Проверка обработки ошибки при запросе несуществующего товара
**Endpoint**: `POST /good/get`
**Тестовые данные**: ID=99999 (заведомо несуществующий)
**Проверки**:
- Статус ответа 404
- Код ошибки "there_is_no_good"
- Сообщение об ошибке "the good was not found"

### 7. test_create_invalid_good()
**Назначение**: Проверка обработки ошибки при создании товара с неверными данными
**Endpoint**: `POST /good/create`
**Тестовые данные**: Товар с неверным типом данных (ID как строка)
**Проверки**:
- Статус ответа 422
- Код ошибки "marshal_error"
- Ошибка связана с неверным форматом данных

### 8. test_create_duplicate_id()
**Назначение**: Проверка обработки дупликатов 
**Endpoint**: `POST /good/create`
**Тестовые данные**: 2 товара с одинаковыми ID
**Проверки**:
- Статус ответа 400
- Код ошибки "User with this id already exists"
- При проверке можно выявить, что валидация дубликатов - отсутствует

## Запуск тестов

### Установка зависимостей
```
pip install pytest requests
```

### Основной способ
```
pytest income_testing_api.py -v
```

### Запуск с подробным выводом
```
pytest income_testing_api.py -v -s
```

## Требования для запуска

### Системные требования
- Python 3.6+
- Запущенный Go сервис на localhost:8080

### Установка зависимостей
```
pip install pytest requests
```

## Тестовые данные

### Фикстура sample_good
```python
{
    "id": 12,
    "name": "Test Product",
    "description": "Test description", 
    "count": 1,
    "weight": 1
}
```

### Начальные данные сервера
- iPhone 16 Pro (ID: 1, 1 шт, 0.2 кг)
- Dyson V12 (ID: 2, 2 шт, 3.0 кг)

## Особенности тестирования

### Автоматическая очистка
Тесты создания, обновления и удаления автоматически очищают тестовые данные после выполнения, чтобы не влиять на другие тесты.

### Изоляция тестов
Каждый тест работает независимо, используя уникальные тестовые данные.

### Проверка ошибок
Тесты включают проверку как успешных сценариев, так и обработки ошибок (404, 422).

### Полное покрытие
Тесты покрывают все CRUD операции и основные сценарии использования API.
